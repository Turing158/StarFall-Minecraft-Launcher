<UserControl x:Class="StarFallMC.Component.ProcessProgresses"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:StarFallMC.Component"
             mc:Ignorable="d"
             d:DesignHeight="300" d:DesignWidth="300">
    <UserControl.Resources>
        <Style x:Key="ProcessListViewItem" TargetType="ListViewItem" BasedOn="{StaticResource {x:Type ListViewItem}}">
            <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ListViewItem">
                    <local:CollapsePanel 
                        Margin="10 2" 
                        MainHeight="35"
                        Background="{DynamicResource PrimaryBrush_1}"
                        MainRadius="5"
                        IsOpen="True">
                        <local:CollapsePanel.TitleContent>
                            <Grid>
                                <Border Name="LimitProcessName" Height="1" Margin="10  0 50 0"></Border>
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="10 0">
                                    <TextBlock Text="{Binding ProgressIcon}" 
                                               FontFamily="{StaticResource IconFontFamily}"
                                               RenderTransformOrigin="0.5,0.5"
                                               Foreground="{DynamicResource SecondaryBrush}"
                                               FontSize="20" Margin="0 0 5 0">
                                        <TextBlock.RenderTransform>
                                            <RotateTransform></RotateTransform>
                                        </TextBlock.RenderTransform>
                                        <TextBlock.Triggers>
                                            <EventTrigger RoutedEvent="Loaded">
                                                <BeginStoryboard>
                                                    <Storyboard RepeatBehavior="Forever">
                                                        <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                                                         BeginTime="0:0:1.5" To="-20" Duration="0:0:0.15"></DoubleAnimation>
                                                        <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                                                         BeginTime="0:0:1.65" To="0" Duration="0:0:0.15"></DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </TextBlock.Triggers>
                                    </TextBlock>
                                    <TextBlock Text="{Binding ProgressName}" 
                                               Foreground="{DynamicResource SecondaryBrush}" 
                                               FontSize="14" 
                                               Width="{Binding ActualWidth,ElementName=LimitProcessName}"
                                               TextWrapping="NoWrap"
                                               TextTrimming="CharacterEllipsis"
                                               VerticalAlignment="Center"></TextBlock>
                                </StackPanel>
                            </Grid>
                        </local:CollapsePanel.TitleContent>
                        <local:CollapsePanel.TitleOperateContent>
                            <local:TextButton Content="&#xe90b;" FontSize="20" 
                                              Foreground="{DynamicResource SecondaryBrush}"
                                              HorizontalAlignment="Right" 
                                              Margin="5 0"
                                              Tag="{Binding ProgressKey}"
                                              Click="ProcessDelete_OnClick"></local:TextButton>
                        </local:CollapsePanel.TitleOperateContent>
                        <local:CollapsePanel.Content>
                            <ListView ItemsSource="{Binding Progesses}" Margin="0 0 0 5">
                                <ListView.ItemContainerStyle>
                                    <Style TargetType="ListViewItem">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListViewItem">
                                                    <Grid Margin="10 5">
                                                        <Border Name="ExtendLine" Height="2" Margin="5 0 20 0" Background="{DynamicResource SecondaryBrush}"></Border>
                                                        <Grid HorizontalAlignment="Left">
                                                            <TextBlock Background="{DynamicResource PrimaryBrush_1}" 
                                                                       Foreground="{DynamicResource SecondaryBrush}"
                                                                       Text="{Binding ProgressName}"
                                                                       Padding="5 0"
                                                                       FontSize="14"
                                                                       HorizontalAlignment="Left"
                                                                       MaxWidth="{Binding ActualWidth,ElementName=ExtendLine}"
                                                                       TextWrapping="NoWrap"
                                                                       TextTrimming="CharacterEllipsis"
                                                                       Margin="5 0">
                                                            </TextBlock>
                                                        </Grid>
                                                        <TextBlock Name="ErrorLabel" Text="&#xe90b;" FontSize="17" 
                                                                   Background="{DynamicResource PrimaryBrush_1}"
                                                                   FontFamily="{StaticResource IconFontFamily}"
                                                                   Foreground="{DynamicResource SecondaryBrush}"
                                                                   HorizontalAlignment="Right"
                                                                   VerticalAlignment="Center"
                                                                   RenderTransformOrigin="0.5,0.5"
                                                                   Visibility="{Binding ErrorVisibility}">
                                                            <TextBlock.RenderTransform>
                                                                 <ScaleTransform></ScaleTransform>
                                                            </TextBlock.RenderTransform>
                                                        </TextBlock>
                                                        <Grid Visibility="{Binding CompleteVisibility}"
                                                              HorizontalAlignment="Right"
                                                              VerticalAlignment="Center">
                                                            <TextBlock Text="&#xe651;" FontSize="9"
                                                                       Background="{DynamicResource PrimaryBrush_1}"
                                                                       FontFamily="{StaticResource IconFontFamily}"
                                                                       Foreground="{DynamicResource SecondaryBrush}"></TextBlock>
                                                            <Border Name="CompleteLabelBorder" Background="{DynamicResource PrimaryBrush_1}"
                                                                    Visibility="{Binding CompleteVisibility}"
                                                                    RenderTransformOrigin="1,0">
                                                                <Border.RenderTransform>
                                                                    <ScaleTransform ScaleX="0"></ScaleTransform>
                                                                </Border.RenderTransform>
                                                            </Border>
                                                        </Grid>
                                                        <TextBlock Name="DoingLabel" Text="&#xe679;" FontSize="14"
                                                                   Background="{DynamicResource PrimaryBrush_1}"
                                                                   FontFamily="{StaticResource IconFontFamily}"
                                                                   Foreground="{DynamicResource SecondaryBrush}"
                                                                   HorizontalAlignment="Right"
                                                                   VerticalAlignment="Center"
                                                                   Visibility="{Binding DoingVisibility}"
                                                                   RenderTransformOrigin="0.5,0.5">
                                                            <TextBlock.RenderTransform>
                                                                <TransformGroup>
                                                                    <RotateTransform Angle="0"></RotateTransform>
                                                                    <ScaleTransform></ScaleTransform>
                                                                </TransformGroup>
                                                            </TextBlock.RenderTransform>
                                                            <TextBlock.Triggers>
                                                                <EventTrigger RoutedEvent="Loaded">
                                                                    <BeginStoryboard>
                                                                        <Storyboard RepeatBehavior="Forever">
                                                                            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(RotateTransform.Angle)"
                                                                                To="360" Duration="0:0:1"></DoubleAnimation>
                                                                        </Storyboard>
                                                                    </BeginStoryboard>
                                                                </EventTrigger>
                                                            </TextBlock.Triggers>
                                                        </TextBlock>
                                                        <TextBlock Text="&#xe901;" FontSize="16"
                                                                   Background="{DynamicResource PrimaryBrush_1}"
                                                                   FontFamily="{StaticResource IconFontFamily}"
                                                                   Foreground="{DynamicResource SecondaryBrush}"
                                                                   HorizontalAlignment="Right"
                                                                   VerticalAlignment="Center"
                                                                   Visibility="{Binding WaitVisibility}"></TextBlock>
                                                    </Grid>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger SourceName="CompleteLabelBorder" Property="Visibility" Value="Visible">
                                                            <Trigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard TargetName="CompleteLabelBorder" TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)">
                                                                        <DoubleAnimation
                                                                            From="1"
                                                                            To="0"
                                                                            Duration="0:0:0.4"
                                                                            EasingFunction="{StaticResource CubicEase}"></DoubleAnimation>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </Trigger.EnterActions>
                                                        </Trigger>
                                                        <Trigger SourceName="ErrorLabel" Property="Visibility" Value="Visible">
                                                            <Trigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <DoubleAnimation Storyboard.TargetName="ErrorLabel" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                                                                         From="0"
                                                                                         To="1"
                                                                                         Duration="0:0:0.6"
                                                                                         EasingFunction="{StaticResource ElasticEaseOut}"></DoubleAnimation>
                                                                        <DoubleAnimation Storyboard.TargetName="ErrorLabel" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                                                         From="0"
                                                                                         To="1"
                                                                                         Duration="0:0:0.6"
                                                                                         EasingFunction="{StaticResource ElasticEaseOut}"></DoubleAnimation>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </Trigger.EnterActions>
                                                        </Trigger>
                                                        <Trigger SourceName="DoingLabel" Property="Visibility" Value="Visible">
                                                            <Trigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <DoubleAnimation Storyboard.TargetName="DoingLabel" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[1].(ScaleTransform.ScaleX)"
                                                                                         From="0"
                                                                                         To="1"
                                                                                         Duration="0:0:0.4"
                                                                                         EasingFunction="{StaticResource CubicEase}"></DoubleAnimation>
                                                                        <DoubleAnimation Storyboard.TargetName="DoingLabel" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[1].(ScaleTransform.ScaleY)"
                                                                                         From="0"
                                                                                         To="1"
                                                                                         Duration="0:0:0.4"
                                                                                         EasingFunction="{StaticResource CubicEase}"></DoubleAnimation>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </Trigger.EnterActions>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ListView.ItemContainerStyle>
                            </ListView>
                        </local:CollapsePanel.Content>
                    </local:CollapsePanel>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
    </UserControl.Resources>
    <Grid>
        <TextBlock Text="暂无进度" FontSize="18" 
                   HorizontalAlignment="Center" VerticalAlignment="Center"
                   Foreground="{DynamicResource SecondaryBrush}"
                   Visibility="{Binding Progresses,RelativeSource={RelativeSource AncestorType=local:ProcessProgresses},Mode=TwoWay,Converter={StaticResource ListEmptyToVisibleConverter}}"></TextBlock>
        <ScrollViewer CanContentScroll="False">
            <ListView Name="ProcessListView" 
                      ItemContainerStyle="{StaticResource ProcessListViewItem}"
                      ItemsSource="{Binding Progresses,RelativeSource={RelativeSource AncestorType=local:ProcessProgresses},Mode=TwoWay}" Margin="0 10"></ListView>
        </ScrollViewer>
    </Grid>
</UserControl>
