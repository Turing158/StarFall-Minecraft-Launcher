<Page x:Class="StarFallMC.ResourcePages.SubPage.GameInfo"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:local="clr-namespace:StarFallMC.ResourcePages.SubPage"
      xmlns:util="clr-namespace:StarFallMC.Util"
      xmlns:component="clr-namespace:StarFallMC.Component"
      mc:Ignorable="d"
      Title="GameInfo" MinHeight="400" MinWidth="800"
      Unloaded="GameInfo_OnUnloaded">
    <Page.Resources>
        <Style TargetType="component:CollapsePanel" BasedOn="{StaticResource {x:Type component:CollapsePanel}}">
            <Setter Property="Margin" Value="40 0"></Setter>
        </Style>
        <Style TargetType="ListView" BasedOn="{StaticResource {x:Type ListView}}">
            <Setter Property="VirtualizingStackPanel.IsVirtualizing" Value="True"></Setter>
            <Setter Property="VirtualizingStackPanel.VirtualizationMode" Value="Recycling"></Setter>
            <Setter Property="VirtualizingPanel.IsContainerVirtualizable" Value="True"></Setter>
            <Setter Property="VirtualizingPanel.ScrollUnit" Value="Pixel"></Setter>
        </Style>
        <DataTemplate x:Key="ChoiceItem">
            <TextBlock HorizontalAlignment="Left" 
                       VerticalAlignment="Center" 
                       Margin="10 8" 
                       Foreground="{DynamicResource SecondaryBrush}"
                       Text="{Binding DisplayName}"></TextBlock>
        </DataTemplate>
        <DataTemplate x:Key="CurrentChoiceItem">
            <StackPanel HorizontalAlignment="Left" 
                        VerticalAlignment="Center" 
                        Orientation="Horizontal"
                        Margin="40 8 10 8">
                <TextBlock Foreground="{DynamicResource SecondaryBrush}"
                           Text="已选择：" FontSize="14"></TextBlock>
                <TextBlock Foreground="{DynamicResource SecondaryBrush}"
                           Text="{Binding DisplayName}" FontSize="14"></TextBlock>
            </StackPanel>
        </DataTemplate>
        <DataTemplate x:Key="NoSelectTemplate">
            <TextBlock Text="{Binding }" HorizontalAlignment="Left" 
                       VerticalAlignment="Center" 
                       FontSize="16" 
                       Foreground="{DynamicResource SecondaryBrush}"
                       Margin="40 10"></TextBlock>
        </DataTemplate>
        <Style TargetType="component:ComboBox">
            <Setter Property="DeleteButtonVisibility" Value="Collapsed"></Setter>
        </Style>
    </Page.Resources>
    <Grid>
        <Border Style="{StaticResource FrameBg}" Opacity="1"></Border>
        <ScrollViewer Name="ScrollViewer" CanContentScroll="False" VerticalScrollBarVisibility="Visible" Margin="0 0 2 0">
            <StackPanel>
                <Border Style="{StaticResource Rect}" Margin="20">
                    <StackPanel>
                        <Grid>
                            <StackPanel Orientation="Horizontal">
                                <Border Width="40" Height="40"
                                        Margin="10"
                                        CornerRadius="5"
                                        Background="{DynamicResource PrimaryBrush_2}">
                                    <TextBlock Text="{Binding Downloader.Type,Converter={StaticResource MinecraftDownloaderTypeToLabelConverter}}"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               Foreground="{DynamicResource SecondaryBrush}"
                                               FontSize="16"
                                               FontFamily="{StaticResource IconFontFamily}" ></TextBlock>
                                </Border>
                                <Grid Margin="0 10">
                                    <TextBlock Text="{Binding Downloader.Name}" FontSize="16" 
                                               Foreground="{DynamicResource SecondaryBrush}"
                                               VerticalAlignment="Top" 
                                               HorizontalAlignment="Left"></TextBlock>
                                    <TextBlock Text="{Binding Downloader.Description}"
                                               Foreground="{DynamicResource SecondaryBrush}"
                                               Opacity="0.8"
                                               VerticalAlignment="Bottom" 
                                               HorizontalAlignment="Left"></TextBlock>
                                </Grid>
                            </StackPanel>
                            <Border HorizontalAlignment="Right"
                                    VerticalAlignment="Top"
                                    Background="{DynamicResource PrimaryBrush_4}"
                                    Margin="10"
                                    CornerRadius="5">
                                <TextBlock Text="{Binding Downloader.Type}"
                                           Margin="5 2"
                                           Foreground="{DynamicResource PrimaryBrush}"></TextBlock>
                            </Border>
                        </Grid>
                        <Grid Margin="10 5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"></ColumnDefinition>
                                <ColumnDefinition Width="100"></ColumnDefinition>
                                <ColumnDefinition Width="30"></ColumnDefinition>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="30"></RowDefinition>
                                <RowDefinition></RowDefinition>
                            </Grid.RowDefinitions>
                            <component:TextInput VerticalContentAlignment="Center"
                                                 FontSize="15"
                                                 Padding="5 0"
                                                 PlaceholderText="请输入版本号"
                                                 LostFocus="VersionNameInput_OnLostFocus"
                                                 Text="{Binding VersionName}"></component:TextInput>
                            <component:Button Grid.Column="1" 
                                              Margin="5 0" 
                                              Content="开始安装"
                                              Click="StartInstall_OnClick"></component:Button>
                            <component:TextButton Grid.Column="2"
                                              Margin="5  0 0 0"
                                              Content="&#xe60c;"
                                              FontSize="16"
                                              Click="RefreshBtn_OnClick"></component:TextButton>
                            <TextBlock Grid.Row="1" Grid.Column="0"
                                       Text="{Binding VersionTips}" Margin="10 0"
                                       Foreground="{DynamicResource SecondaryBrush}"
                                       Opacity="0.8"
                                       HorizontalAlignment="Left"
                                       VerticalAlignment="Bottom"
                                       Visibility="{Binding IsGoodName,Converter={StaticResource BooleanFalseToVisibilityVisibleConverter}}"></TextBlock>
                        </Grid>
                    </StackPanel>
                </Border>
                <component:ComboBox ItemsSource="{Binding EnabledForgeLoader}" 
                                    ChoiceTemplate="{StaticResource ChoiceItem}"
                                    NoSelectText="Forge"
                                    CurrentChoiceTemplate="{StaticResource CurrentChoiceItem}"
                                    NoSelectTemplate="{StaticResource NoSelectTemplate}"
                                    IsEnabled="{Binding EnableForge}"
                                    SourceEmptyText="没有支持的Forge"
                                    CurrentItem="{Binding SelectedForgeLoader,Mode=OneWayToSource}"
                                    SelectionChanged="LoaderComboBox_OnSelectionChanged"
                                    Visibility="{Binding EnabledForgeLoader,Converter={StaticResource ListEmptyToCollapsedConverter}}">
                    <component:ComboBox.CustomTitleContent>
                        <Image Width="25" Height="25" HorizontalAlignment="Left" 
                                VerticalAlignment="Center"
                                Margin="8 0"
                                Source="../../assets/DefaultGameIcon/Forge.png"></Image>
                    </component:ComboBox.CustomTitleContent>
                </component:ComboBox>
                <component:ComboBox ItemsSource="{Binding LiteLoader}" 
                                    ChoiceTemplate="{StaticResource ChoiceItem}"
                                    NoSelectText="Liteloader"
                                    CurrentChoiceTemplate="{StaticResource CurrentChoiceItem}"
                                    NoSelectTemplate="{StaticResource NoSelectTemplate}"
                                    IsEnabled="{Binding EnableLiteLoader}"
                                    SourceEmptyText="该版本不支持Liteloader"
                                    CurrentItem="{Binding SelectedLiteLoader,Mode=OneWayToSource}"
                                    SelectionChanged="LoaderComboBox_OnSelectionChanged"
                                    Visibility="{Binding LiteLoader,Converter={StaticResource ListEmptyToCollapsedConverter}}">
                    <component:ComboBox.CustomTitleContent>
                        <Image Width="25" Height="25" HorizontalAlignment="Left" 
                               VerticalAlignment="Center"
                               Margin="8 0"
                               Source="../../assets/DefaultGameIcon/LiteLoader.png"></Image>
                    </component:ComboBox.CustomTitleContent>
                </component:ComboBox>
                <component:ComboBox ItemsSource="{Binding NeoForgeLoader}" 
                                    ChoiceTemplate="{StaticResource ChoiceItem}"
                                    NoSelectText="Neoforge"
                                    CurrentChoiceTemplate="{StaticResource CurrentChoiceItem}"
                                    NoSelectTemplate="{StaticResource NoSelectTemplate}"
                                    IsEnabled="{Binding EnableNeoForge}"
                                    SourceEmptyText="该版本不支持Neoforge"
                                    CurrentItem="{Binding SelectedNeoForgeLoader,Mode=OneWayToSource}"
                                    SelectionChanged="LoaderComboBox_OnSelectionChanged"
                                    MouseLeftButtonUp="NeoForgeSelectComboBox_OnMouseLeftButtonUp"
                                    Visibility="{Binding NeoForgeLoader,Converter={StaticResource ListEmptyToCollapsedConverter}}">
                    <component:ComboBox.CustomTitleContent>
                        <Image Width="25" Height="25" HorizontalAlignment="Left" 
                               VerticalAlignment="Center"
                               Margin="8 0"
                               Source="../../assets/DefaultGameIcon/NeoForge.png"></Image>
                    </component:ComboBox.CustomTitleContent>
                </component:ComboBox>
                <component:ComboBox ItemsSource="{Binding EnabledOptifineLoader}" 
                                    NoSelectText="Optifine"
                                    CurrentChoiceTemplate="{StaticResource CurrentChoiceItem}"
                                    NoSelectTemplate="{StaticResource NoSelectTemplate}"
                                    IsEnabled="{Binding EnableOptifine}"
                                    SourceEmptyText="没有支持的Optifine"
                                    CurrentItem="{Binding SelectedOptifineLoader,Mode=OneWayToSource}"
                                    SelectionChanged="LoaderComboBox_OnSelectionChanged"
                                    Visibility="{Binding EnabledOptifineLoader,Converter={StaticResource ListEmptyToCollapsedConverter}}">
                    <component:ComboBox.ChoiceTemplate>
                        <DataTemplate>
                            <Grid>
                                <TextBlock HorizontalAlignment="Left" 
                                           VerticalAlignment="Center" 
                                           Margin="10 8" 
                                           Foreground="{DynamicResource SecondaryBrush}"
                                           Text="{Binding DisplayName}"></TextBlock>
                                <TextBlock HorizontalAlignment="Right" 
                                           VerticalAlignment="Center" 
                                           Margin="0 8" 
                                           Foreground="{DynamicResource SecondaryBrush}"
                                           Opacity="0.6"
                                           Visibility="{Binding NeedForge,Converter={StaticResource NullObjectToVisibilityCollapsedConverter}}">
                                    <Run Text="兼容 Forge"></Run>
                                    <Run Text="{Binding NeedForge.Version}"></Run>
                                </TextBlock>
                            </Grid>
                        </DataTemplate>
                    </component:ComboBox.ChoiceTemplate>
                    <component:ComboBox.CustomTitleContent>
                        <Image Width="25" Height="25" HorizontalAlignment="Left" 
                               VerticalAlignment="Center"
                               Margin="8 0"
                               Source="../../assets/DefaultGameIcon/Optifine.png"></Image>
                    </component:ComboBox.CustomTitleContent>
                </component:ComboBox>
                <component:ComboBox ItemsSource="{Binding FabricLoader}" 
                                    ChoiceTemplate="{StaticResource ChoiceItem}"
                                    NoSelectText="Fabric"
                                    CurrentChoiceTemplate="{StaticResource CurrentChoiceItem}"
                                    NoSelectTemplate="{StaticResource NoSelectTemplate}"
                                    IsEnabled="{Binding EnableFabric}"
                                    SourceEmptyText="该版本不支持Fabric"
                                    CurrentItem="{Binding SelectedFabricLoader,Mode=OneWayToSource}"
                                    SelectionChanged="FabricComboBox_OnSelectionChanged"
                                    Visibility="{Binding FabricLoader,Converter={StaticResource ListEmptyToCollapsedConverter}}">
                    <component:ComboBox.CustomTitleContent>
                        <Image Width="25" Height="25" HorizontalAlignment="Left" 
                               VerticalAlignment="Center"
                               Margin="8 0"
                               Source="../../assets/DefaultGameIcon/Fabric.png"></Image>
                    </component:ComboBox.CustomTitleContent>
                </component:ComboBox>
                <component:ComboBox ItemsSource="{Binding FabricApiVersions}" 
                                    ChoiceTemplate="{StaticResource ChoiceItem}"
                                    NoSelectText="Fabric Api"
                                    CurrentChoiceTemplate="{StaticResource CurrentChoiceItem}"
                                    NoSelectTemplate="{StaticResource NoSelectTemplate}"
                                    SourceEmptyText="未找到对应的Fabric API版本"
                                    SelectedIndex="{Binding SelectedFabricApiIndex}"
                                    Visibility="{Binding FabricApiVisibility}">
                    <component:ComboBox.CustomTitleContent>
                        <Image Width="25" Height="25" HorizontalAlignment="Left" 
                               VerticalAlignment="Center"
                               Margin="8 0"
                               Source="../../assets/DefaultGameIcon/Fabric.png"></Image>
                    </component:ComboBox.CustomTitleContent>
                </component:ComboBox>
                <component:ComboBox ItemsSource="{Binding QuiltLoader}" 
                                    ChoiceTemplate="{StaticResource ChoiceItem}"
                                    NoSelectText="Quilt"
                                    CurrentChoiceTemplate="{StaticResource CurrentChoiceItem}"
                                    NoSelectTemplate="{StaticResource NoSelectTemplate}"
                                    IsEnabled="{Binding EnableQuilt}"
                                    SourceEmptyText="该版本不支持Quilt"
                                    CurrentItem="{Binding SelectedQuiltLoader,Mode=OneWayToSource}"
                                    SelectionChanged="LoaderComboBox_OnSelectionChanged"
                                    Visibility="{Binding QuiltLoader,Converter={StaticResource ListEmptyToCollapsedConverter}}">
                    <component:ComboBox.CustomTitleContent>
                        <Image Width="25" Height="25" HorizontalAlignment="Left" 
                               VerticalAlignment="Center"
                               Margin="8 0"
                               Source="../../assets/DefaultGameIcon/quiltmc.png"></Image>
                    </component:ComboBox.CustomTitleContent>
                </component:ComboBox>
            </StackPanel>
        </ScrollViewer>
        <component:Loading x:Name="LoadingBorder" Width="150" Height="100" PercentText="{Binding PercentText}"></component:Loading>
        <component:TopButton Margin="20 40" BindingScrollViewer="{Binding ElementName=ScrollViewer}"></component:TopButton>
    </Grid>
</Page>
